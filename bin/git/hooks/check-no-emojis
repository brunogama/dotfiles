#!/usr/bin/env bash
#
# check-no-emojis - Check for emojis in staged files
# Enforces MINDSET.MD Rule 2: No emojis in documentation or code
#

set -euo pipefail

# Colors
RED='\033[0;31m'
YELLOW='\033[1;33m'
NC='\033[0m'

# Get staged files
FILES=$(git diff --cached --name-only --diff-filter=ACM | grep -E '\.(md|sh|zsh|bash|txt|yaml|json)$' || true)

if [[ -z "$FILES" ]]; then
    exit 0
fi

FOUND=false

# Check each file for emojis using perl regex
for file in $FILES; do
    if [[ -f "$file" ]]; then
        # Check for Unicode emoji ranges
        # perl exits 1 if emojis found, 0 if not found
        if ! perl -CSD -ne 'exit 1 if /[\x{1F300}-\x{1F9FF}\x{2600}-\x{26FF}\x{2700}-\x{27BF}\x{231A}-\x{23F3}]/' "$file"; then
            echo -e "${RED}ERROR: Emojis found in $file${NC}"
            echo "MINDSET.MD Rule 2: No emojis allowed in documentation or code"
            FOUND=true
        fi
    fi
done

if [[ "$FOUND" == "true" ]]; then
    echo ""
    echo -e "${YELLOW}Fix: Remove emojis from the files above${NC}"
    echo "See MINDSET.MD for constitutional rules"
    exit 1
fi

exit 0
