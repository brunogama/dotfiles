#!/usr/bin/env bash
# Home Sync - Python wrapper entry point
# This script invokes the Python home_sync package using the venv

set -euo pipefail

# Get script directory (resolve symlinks)
SCRIPT_PATH="${BASH_SOURCE[0]}"
# Resolve symlinks
while [[ -L "$SCRIPT_PATH" ]]; do
    SCRIPT_DIR="$(cd "$(dirname "$SCRIPT_PATH")" && pwd)"
    SCRIPT_PATH="$(readlink "$SCRIPT_PATH")"
    [[ "$SCRIPT_PATH" != /* ]] && SCRIPT_PATH="$SCRIPT_DIR/$SCRIPT_PATH"
done
SCRIPT_DIR="$(cd "$(dirname "$SCRIPT_PATH")" && pwd)"

VENV_PYTHON="$SCRIPT_DIR/home_sync/.venv/bin/python"
VENV_HOME_SYNC="$SCRIPT_DIR/home_sync/.venv/bin/home-sync"

# Check if venv exists and has home-sync installed
if [[ -x "$VENV_HOME_SYNC" ]]; then
    exec "$VENV_HOME_SYNC" "$@"
elif [[ -x "$VENV_PYTHON" ]]; then
    exec "$VENV_PYTHON" -m home_sync.cli "$@"
else
    echo "Error: home-sync virtual environment not found" >&2
    echo "" >&2
    echo "Installation required:" >&2
    echo "  cd $SCRIPT_DIR/home_sync && python3 -m venv .venv && .venv/bin/pip install -e '.[dev]'" >&2
    exit 1
fi
